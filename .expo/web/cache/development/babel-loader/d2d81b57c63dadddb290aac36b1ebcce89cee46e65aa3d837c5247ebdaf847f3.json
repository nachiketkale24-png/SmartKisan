{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport { mockCrops, mockIrrigationRecommendations } from \"../data/mockData\";\nvar API_BASE_URL = 'http://localhost:3000/api';\nvar ApiService = function () {\n  function ApiService() {\n    _classCallCheck(this, ApiService);\n  }\n  return _createClass(ApiService, [{\n    key: \"fetchSensorData\",\n    value: function () {\n      var _fetchSensorData = _asyncToGenerator(function* (cropId) {\n        try {\n          var response = yield fetch(`${API_BASE_URL}/sensors/${cropId}`, {\n            method: 'GET',\n            headers: {\n              'Content-Type': 'application/json'\n            }\n          });\n          if (response.ok) {\n            return yield response.json();\n          }\n        } catch (error) {\n          console.log('Backend unavailable, using mock data');\n        }\n        var crop = mockCrops.find(function (c) {\n          return c.id === cropId;\n        });\n        return (crop == null ? void 0 : crop.sensorData) || null;\n      });\n      function fetchSensorData(_x) {\n        return _fetchSensorData.apply(this, arguments);\n      }\n      return fetchSensorData;\n    }()\n  }, {\n    key: \"getIrrigationRecommendation\",\n    value: function () {\n      var _getIrrigationRecommendation = _asyncToGenerator(function* (cropId, manualInput) {\n        try {\n          var endpoint = manualInput ? `${API_BASE_URL}/irrigation/calculate` : `${API_BASE_URL}/irrigation/recommendation/${cropId}`;\n          var response = yield fetch(endpoint, {\n            method: manualInput ? 'POST' : 'GET',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: manualInput ? JSON.stringify(_objectSpread({\n              cropId: cropId\n            }, manualInput)) : undefined\n          });\n          if (response.ok) {\n            return yield response.json();\n          }\n        } catch (error) {\n          console.log('Backend unavailable, using mock/calculated data');\n        }\n        if (manualInput) {\n          return this.calculateIrrigationLocally(cropId, manualInput);\n        }\n        return mockIrrigationRecommendations.find(function (rec) {\n          return rec.cropId === cropId;\n        }) || null;\n      });\n      function getIrrigationRecommendation(_x2, _x3) {\n        return _getIrrigationRecommendation.apply(this, arguments);\n      }\n      return getIrrigationRecommendation;\n    }()\n  }, {\n    key: \"calculateIrrigationLocally\",\n    value: function calculateIrrigationLocally(cropId, input) {\n      var crop = mockCrops.find(function (c) {\n        return c.id === cropId;\n      });\n      var cropName = (crop == null ? void 0 : crop.name) || 'Crop';\n      var cropNameHindi = (crop == null ? void 0 : crop.nameHindi) || 'फसल';\n      var waterAmount = 2000;\n      var priority = 'Medium';\n      var reasons = [];\n      var reasonsHindi = [];\n      if (input.temperature > 35) {\n        waterAmount += 1500;\n        priority = 'High';\n        reasons.push('Temperature very high');\n        reasonsHindi.push('तापमान बहुत अधिक है');\n      } else if (input.temperature > 30) {\n        waterAmount += 1000;\n        reasons.push('Temperature is high');\n        reasonsHindi.push('तापमान अधिक है');\n      }\n      if (input.soilMoisture < 30) {\n        waterAmount += 2000;\n        priority = 'High';\n        reasons.push('Soil moisture critically low');\n        reasonsHindi.push('मिट्टी की नमी बहुत कम है');\n      } else if (input.soilMoisture < 45) {\n        waterAmount += 1000;\n        reasons.push('Soil moisture is low');\n        reasonsHindi.push('मिट्टी की नमी कम है');\n      }\n      if (input.soilType === 'Sandy') {\n        waterAmount += 500;\n        reasons.push('Sandy soil needs more water');\n        reasonsHindi.push('रेतीली मिट्टी में अधिक पानी चाहिए');\n      } else if (input.soilType === 'Clay') {\n        waterAmount -= 300;\n        reasons.push('Clay soil retains water');\n        reasonsHindi.push('चिकनी मिट्टी पानी रोकती है');\n      }\n      if (input.cropStage === 'Flowering' || input.cropStage === 'Fruiting') {\n        waterAmount += 1000;\n        if (priority !== 'High') priority = 'Medium';\n        reasons.push(`${input.cropStage} stage needs more water`);\n        reasonsHindi.push(`${input.cropStage} अवस्था में अधिक पानी चाहिए`);\n      }\n      var waterSaving = Math.floor(Math.random() * 15) + 10;\n      return {\n        id: `calc-${Date.now()}`,\n        cropId: cropId,\n        cropName: cropName,\n        cropNameHindi: cropNameHindi,\n        recommendedWater: waterAmount,\n        reason: reasons.join('. ') || 'Standard irrigation recommended',\n        reasonHindi: reasonsHindi.join('। ') || 'सामान्य सिंचाई की सलाह है',\n        priority: priority,\n        waterSaving: waterSaving\n      };\n    }\n  }, {\n    key: \"syncOfflineData\",\n    value: function () {\n      var _syncOfflineData = _asyncToGenerator(function* (data) {\n        try {\n          var response = yield fetch(`${API_BASE_URL}/sync`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(data)\n          });\n          return response.ok;\n        } catch (error) {\n          console.log('Sync failed, will retry later');\n          return false;\n        }\n      });\n      function syncOfflineData(_x4) {\n        return _syncOfflineData.apply(this, arguments);\n      }\n      return syncOfflineData;\n    }()\n  }]);\n}();\nexport var apiService = new ApiService();\nexport default apiService;","map":{"version":3,"names":["mockCrops","mockIrrigationRecommendations","API_BASE_URL","ApiService","_classCallCheck","_createClass","key","value","_fetchSensorData","_asyncToGenerator","cropId","response","fetch","method","headers","ok","json","error","console","log","crop","find","c","id","sensorData","fetchSensorData","_x","apply","arguments","_getIrrigationRecommendation","manualInput","endpoint","body","JSON","stringify","_objectSpread","undefined","calculateIrrigationLocally","rec","getIrrigationRecommendation","_x2","_x3","input","cropName","name","cropNameHindi","nameHindi","waterAmount","priority","reasons","reasonsHindi","temperature","push","soilMoisture","soilType","cropStage","waterSaving","Math","floor","random","Date","now","recommendedWater","reason","join","reasonHindi","_syncOfflineData","data","syncOfflineData","_x4","apiService"],"sources":["C:/Users/nachi.NACHIKET/Desktop/New folder (3)/src/services/apiService.ts"],"sourcesContent":["import { SensorData, IrrigationRecommendation, ManualSensorInput } from '../types';\r\nimport { mockCrops, mockIrrigationRecommendations } from '../data/mockData';\r\n\r\nconst API_BASE_URL = 'http://localhost:3000/api'; // Change to your backend URL\r\n\r\nclass ApiService {\r\n  // Fetch sensor data from backend\r\n  async fetchSensorData(cropId: string): Promise<SensorData | null> {\r\n    try {\r\n      // Try to fetch from backend\r\n      const response = await fetch(`${API_BASE_URL}/sensors/${cropId}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      if (response.ok) {\r\n        return await response.json();\r\n      }\r\n    } catch (error) {\r\n      console.log('Backend unavailable, using mock data');\r\n    }\r\n\r\n    // Fallback to mock data\r\n    const crop = mockCrops.find(c => c.id === cropId);\r\n    return crop?.sensorData || null;\r\n  }\r\n\r\n  // Get irrigation recommendation from backend or calculate locally\r\n  async getIrrigationRecommendation(\r\n    cropId: string,\r\n    manualInput?: ManualSensorInput\r\n  ): Promise<IrrigationRecommendation | null> {\r\n    try {\r\n      const endpoint = manualInput\r\n        ? `${API_BASE_URL}/irrigation/calculate`\r\n        : `${API_BASE_URL}/irrigation/recommendation/${cropId}`;\r\n\r\n      const response = await fetch(endpoint, {\r\n        method: manualInput ? 'POST' : 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: manualInput ? JSON.stringify({ cropId, ...manualInput }) : undefined,\r\n      });\r\n\r\n      if (response.ok) {\r\n        return await response.json();\r\n      }\r\n    } catch (error) {\r\n      console.log('Backend unavailable, using mock/calculated data');\r\n    }\r\n\r\n    // Fallback: Use mock data or calculate locally\r\n    if (manualInput) {\r\n      return this.calculateIrrigationLocally(cropId, manualInput);\r\n    }\r\n\r\n    return mockIrrigationRecommendations.find(rec => rec.cropId === cropId) || null;\r\n  }\r\n\r\n  // Local irrigation calculation when backend is unavailable\r\n  private calculateIrrigationLocally(\r\n    cropId: string,\r\n    input: ManualSensorInput\r\n  ): IrrigationRecommendation {\r\n    const crop = mockCrops.find(c => c.id === cropId);\r\n    const cropName = crop?.name || 'Crop';\r\n    const cropNameHindi = crop?.nameHindi || 'फसल';\r\n\r\n    // Simple irrigation calculation logic\r\n    let waterAmount = 2000; // Base water in liters\r\n    let priority: 'High' | 'Medium' | 'Low' = 'Medium';\r\n    let reasons: string[] = [];\r\n    let reasonsHindi: string[] = [];\r\n\r\n    // Temperature factor\r\n    if (input.temperature > 35) {\r\n      waterAmount += 1500;\r\n      priority = 'High';\r\n      reasons.push('Temperature very high');\r\n      reasonsHindi.push('तापमान बहुत अधिक है');\r\n    } else if (input.temperature > 30) {\r\n      waterAmount += 1000;\r\n      reasons.push('Temperature is high');\r\n      reasonsHindi.push('तापमान अधिक है');\r\n    }\r\n\r\n    // Soil moisture factor\r\n    if (input.soilMoisture < 30) {\r\n      waterAmount += 2000;\r\n      priority = 'High';\r\n      reasons.push('Soil moisture critically low');\r\n      reasonsHindi.push('मिट्टी की नमी बहुत कम है');\r\n    } else if (input.soilMoisture < 45) {\r\n      waterAmount += 1000;\r\n      reasons.push('Soil moisture is low');\r\n      reasonsHindi.push('मिट्टी की नमी कम है');\r\n    }\r\n\r\n    // Soil type factor\r\n    if (input.soilType === 'Sandy') {\r\n      waterAmount += 500;\r\n      reasons.push('Sandy soil needs more water');\r\n      reasonsHindi.push('रेतीली मिट्टी में अधिक पानी चाहिए');\r\n    } else if (input.soilType === 'Clay') {\r\n      waterAmount -= 300;\r\n      reasons.push('Clay soil retains water');\r\n      reasonsHindi.push('चिकनी मिट्टी पानी रोकती है');\r\n    }\r\n\r\n    // Growth stage factor\r\n    if (input.cropStage === 'Flowering' || input.cropStage === 'Fruiting') {\r\n      waterAmount += 1000;\r\n      if (priority !== 'High') priority = 'Medium';\r\n      reasons.push(`${input.cropStage} stage needs more water`);\r\n      reasonsHindi.push(`${input.cropStage} अवस्था में अधिक पानी चाहिए`);\r\n    }\r\n\r\n    const waterSaving = Math.floor(Math.random() * 15) + 10;\r\n\r\n    return {\r\n      id: `calc-${Date.now()}`,\r\n      cropId,\r\n      cropName,\r\n      cropNameHindi,\r\n      recommendedWater: waterAmount,\r\n      reason: reasons.join('. ') || 'Standard irrigation recommended',\r\n      reasonHindi: reasonsHindi.join('। ') || 'सामान्य सिंचाई की सलाह है',\r\n      priority,\r\n      waterSaving,\r\n    };\r\n  }\r\n\r\n  // Sync offline data with backend\r\n  async syncOfflineData(data: any): Promise<boolean> {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}/sync`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(data),\r\n      });\r\n\r\n      return response.ok;\r\n    } catch (error) {\r\n      console.log('Sync failed, will retry later');\r\n      return false;\r\n    }\r\n  }\r\n}\r\n\r\nexport const apiService = new ApiService();\r\nexport default apiService;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}